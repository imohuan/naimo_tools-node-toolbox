import{d as A,r as h,a as E,c as j,b as g,n as C,e as B,f as e,g as L,h as H,t as k,o as u,u as U,i as R,j as F,k as z,w as S,l as $,m as M,F as G}from"./main.CX8EqZtS.js";const K=A("node",()=>{const x=h({nodeVersion:null,npmVersion:null,nodePath:null,hasUpdate:!1}),a=h([]),s=h("win-x64"),c=h(!1);function r(o,l){const i=n=>n.replace(/^v/,"").split(".").map(v=>parseInt(v)||0),p=i(o),I=i(l);for(let n=0;n<Math.max(p.length,I.length);n++){const t=p[n]||0,w=I[n]||0;if(t<w)return-1;if(t>w)return 1}return 0}function d(){if(x.value.nodeVersion&&a.value.length>0){const o=a.value.find(l=>l.lts);o&&(x.value.hasUpdate=r(x.value.nodeVersion,o.version)<0)}}async function b(){c.value=!0;try{const o=await window.nodeToolboxAPI.getEnvironmentInfo();x.value={nodeVersion:o.nodeVersion,npmVersion:o.npmVersion,nodePath:o.nodePath,hasUpdate:!1},d()}catch(o){console.error("获取 Node 信息失败:",o)}finally{c.value=!1}}async function y(){c.value=!0;try{const l=await(await fetch("https://nodejs.org/dist/index.json")).json();a.value=l.slice(0,50),d()}catch(o){console.error("获取版本列表失败:",o)}finally{c.value=!1}}function _(){const o=navigator.userAgent.toLowerCase(),l=navigator.platform.toLowerCase();return l.includes("win")?"win-x64":l.includes("mac")||o.includes("mac")?o.includes("arm")||l.includes("arm")?"darwin-arm64":"darwin-x64":l.includes("linux")||o.includes("linux")?o.includes("arm")||l.includes("arm")?"linux-arm64":"linux-x64":"win-x64"}function f(o){const l=_();let i,p;if(l==="win-x64")i=`node-${o}-x64.msi`,p=`https://nodejs.org/dist/${o}/${i}`;else if(l==="win-x86")i=`node-${o}-x86.msi`,p=`https://nodejs.org/dist/${o}/${i}`;else if(l==="win-arm64")i=`node-${o}-win-arm64.zip`,p=`https://nodejs.org/dist/${o}/${i}`;else if(l.startsWith("darwin"))i=`node-${o}.pkg`,p=`https://nodejs.org/dist/${o}/${i}`;else if(l==="linux-x64")i=`node-${o}-linux-x64.tar.xz`,p=`https://nodejs.org/dist/${o}/${i}`;else if(l==="linux-arm64")i=`node-${o}-linux-arm64.tar.xz`,p=`https://nodejs.org/dist/${o}/${i}`;else throw new Error(`不支持的平台: ${l}`);return{url:p,filename:i}}return{nodeInfo:x,versions:a,selectedPlatform:s,isLoading:c,fetchNodeInfo:b,fetchVersions:y,getDownloadInfo:f}}),O=["disabled"],W={class:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},q={class:"flex-1 flex items-center justify-between relative z-10"},J={class:"text-left"},Q={class:"flex items-center gap-2 mb-1"},X={class:"text-sm text-gray-500"},Y={class:"text-xl font-bold text-gray-900 font-mono"},Z={key:0,class:"text-xs text-gray-400 mt-0.5"},ee={key:1,class:"text-xs text-gray-600 mt-1 space-y-0.5"},te={class:"flex items-center gap-2"},oe={class:"font-mono"},ne={class:"font-mono"},se={class:"text-gray-500"},N=E({__name:"DownloadButton",props:{url:{},filename:{},version:{},date:{default:""},label:{default:"版本"},badgeText:{default:"下载"},variant:{default:"lts"}},emits:["downloadStart","downloadComplete","downloadError"],setup(x,{emit:a}){const s=x,c=a,r=h(!1),d=h(0),b=h(0),y=h(0),_=h(0),f=h(""),o=j(()=>r.value?"border-blue-400 cursor-wait":s.variant==="lts"?"border-green-200 hover:border-green-400":"border-blue-200 hover:border-blue-400"),l=j(()=>{const w="bg-gradient-to-br";return s.variant==="lts"?`${w} from-green-400 to-emerald-500 group-hover:scale-110`:`${w} from-blue-400 to-indigo-500 group-hover:scale-110`}),i=j(()=>r.value?"bg-blue-500 animate-pulse":s.variant==="lts"?"bg-green-500":"bg-blue-500"),p=j(()=>s.variant==="lts"?"text-green-500":"text-blue-500"),I=j(()=>s.variant==="lts"?"from-green-400 to-emerald-500":"from-blue-400 to-indigo-500");function n(w){if(w===0)return"0 B";const v=1024,P=["B","KB","MB","GB"],D=Math.floor(Math.log(w)/Math.log(v));return Math.round(w/Math.pow(v,D)*100)/100+" "+P[D]}async function t(){if(r.value)return;r.value=!0,d.value=0,b.value=0,y.value=0,_.value=0,f.value="",c("downloadStart",s.version);let w=null,v=null,P=null;const D=()=>{w?.(),v?.(),P?.(),f.value=""};try{w=naimo.download.onDownloadProgress(m=>{console.log("Progress event:",f.value,m),f.value&&m.id===f.value&&(console.log("Updating progress:",m.progress),d.value=m.progress,b.value=m.bytesReceived,y.value=m.totalBytes,_.value=m.downloadRate)}),v=naimo.download.onDownloadCompleted(async m=>{if(console.log("Completed event:",f.value,m),f.value&&m.id===f.value){d.value=100,r.value=!1,D();try{await naimo.shell.openPath(m.filePath)}catch(T){console.error("打开文件失败:",T)}c("downloadComplete",m.filePath)}}),P=naimo.download.onDownloadError(m=>{console.log("Error event:",f.value,m),f.value&&m.id===f.value&&(r.value=!1,D(),c("downloadError",m.error))});const V=await naimo.download.startDownload({url:s.url,saveAsFilename:s.filename});if(console.log("Download started with ID:",V),!V)throw new Error("下载启动失败：未获取到下载 ID");f.value=V}catch(V){console.error("Download error:",V),r.value=!1,D(),c("downloadError",String(V))}}return(w,v)=>(u(),g("button",{onClick:t,disabled:r.value,class:C(["group flex-1 px-6 py-4 bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border-2 flex items-center gap-4 relative overflow-hidden",o.value])},[r.value?(u(),g("div",{key:0,class:C(["absolute inset-0 bg-gradient-to-r opacity-10 transition-all duration-300",I.value]),style:L({width:d.value+"%"})},null,6)):B("",!0),e("div",{class:C(["w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 transition-transform relative z-10",l.value])},[(u(),g("svg",W,[H(w.$slots,"icon",{},()=>[v[0]||(v[0]=e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1))])]))],2),e("div",q,[e("div",J,[e("div",Q,[e("span",X,k(x.label),1),e("span",{class:C(["px-2 py-0.5 text-white text-xs font-bold rounded",i.value])},k(r.value?"下载中":x.badgeText),3)]),e("p",Y,k(x.version),1),r.value?(u(),g("div",ee,[e("div",te,[e("span",oe,k(d.value.toFixed(1))+"%",1),v[1]||(v[1]=e("span",{class:"text-gray-400"},"•",-1)),e("span",ne,k(n(_.value))+"/s",1)]),e("div",se,k(n(b.value))+" / "+k(n(y.value)),1)])):(u(),g("p",Z,k(x.date),1))]),r.value?(u(),g("svg",{key:1,class:C(["w-5 h-5 flex-shrink-0 animate-spin",p.value]),viewBox:"0 0 24 24"},[...v[3]||(v[3]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"3",fill:"none"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])],2)):(u(),g("svg",{key:0,class:C(["w-5 h-5 flex-shrink-0 transition-transform",p.value]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...v[2]||(v[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])],2))])],10,O))}}),le={class:"w-full h-full relative tech-bg overflow-hidden"},ae={class:"w-full h-full overflow-auto relative z-10"},re={class:"relative z-10 p-6 min-h-full flex flex-col items-center justify-center"},ie={class:"w-full max-w-6xl flex flex-col gap-4"},de={class:"flex gap-4"},ue={class:"w-full px-6 py-4 bg-white rounded-xl shadow-lg transition-all duration-300 border-2 border-gray-200"},ce={class:"flex items-start gap-4"},fe={class:"flex-1"},pe={class:"flex items-center justify-between mb-3"},ve={class:"flex items-center gap-2"},me={key:0,class:"px-2.5 py-1 bg-green-100 text-green-700 rounded text-xs font-medium flex items-center gap-1"},ge={key:1,class:"px-2.5 py-1 bg-yellow-100 text-yellow-700 rounded text-xs font-medium flex items-center gap-1"},xe={class:"flex items-center gap-2"},we={class:"relative group font-mono"},he=["disabled","title"],be={key:0,class:"w-4 h-4 animate-spin",fill:"none",viewBox:"0 0 24 24"},ye={key:0,class:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none z-20"},ke=["disabled"],_e={key:0,class:"w-4 h-4 text-gray-500 group-hover:text-indigo-600 group-hover:rotate-180 transition-all duration-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},Ce={key:1,class:"w-4 h-4 text-indigo-600 animate-spin",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},$e={class:"space-y-2"},Ie={class:"flex items-center justify-between"},je={class:"text-sm font-mono font-bold text-gray-900"},De={class:"flex items-center justify-between"},Ve={class:"text-sm font-mono font-bold text-gray-900"},Pe={class:"pt-2 border-t border-gray-100"},Be={class:"text-xs font-mono text-gray-700 break-all"},Me=E({__name:"NodeManager",setup(x){const a=K(),s=U(),c=h(!1),r=h(!1),d=h({enabled:!1,profileExists:!1,pnpmInstalled:!1,pnpmVersion:void 0}),b=j(()=>a.versions.find(n=>n.lts)),y=j(()=>a.versions[0]);async function _(){try{const n=await window.nodeToolboxAPI.checkNpmPnpmConvert();d.value={enabled:n.enabled,profileExists:n.profileExists,pnpmInstalled:n.pnpmInstalled,pnpmVersion:n.pnpmVersion}}catch(n){console.error("检查 npm→pnpm 转换状态失败:",n)}}async function f(){r.value=!0;try{if(d.value.enabled){s.info("正在禁用 npm→pnpm 自动转换...");const n=await window.nodeToolboxAPI.disableNpmPnpmConvert();n.success?(s.success(n.message),d.value.enabled=!1):s.error(n.message)}else{s.info("正在启用 npm→pnpm 自动转换...");const n=await window.nodeToolboxAPI.enableNpmPnpmConvert();n.success?(s.success(n.message),d.value.enabled=!0):s.error(n.message)}await _()}catch(n){s.error(`操作失败: ${n.message}`)}finally{r.value=!1}}async function o(){c.value=!0,s.info("正在检测 Node 环境..."),await a.fetchNodeInfo(),await _(),s.success("环境检测完成"),c.value=!1}async function l(){s.info("正在获取 Node.js 版本列表..."),await a.fetchVersions(),s.success(`已加载 ${a.versions.length} 个版本`)}function i(n){s.info(`开始下载 ${n}...`)}function p(n){s.success(`下载完成：${n}`)}function I(n){s.error(`下载失败：${n}`)}return R(async()=>{await o(),await l(),await _()}),(n,t)=>(u(),g("div",le,[t[17]||(t[17]=F(`<div class="absolute inset-0 overflow-hidden pointer-events-none" data-v-c0cef825><div class="absolute inset-0 bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50" data-v-c0cef825></div><div class="absolute inset-0 opacity-40" style="background-image:linear-gradient(
              to right,
              #e0e7ff 1px,
              transparent 1px
            ),
            linear-gradient(to bottom, #e0e7ff 1px, transparent 1px);background-size:40px 40px;" data-v-c0cef825></div><div class="absolute top-1/4 left-1/4 w-96 h-96 bg-blue-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob" data-v-c0cef825></div><div class="absolute top-1/3 right-1/4 w-96 h-96 bg-purple-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000" data-v-c0cef825></div><div class="absolute bottom-1/4 left-1/3 w-96 h-96 bg-indigo-400 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000" data-v-c0cef825></div></div>`,1)),e("div",ae,[e("div",re,[e("div",ie,[e("div",de,[b.value?(u(),z(N,{key:0,url:$(a).getDownloadInfo(b.value.version).url,filename:$(a).getDownloadInfo(b.value.version).filename,version:b.value.version,date:b.value.date,label:"长期支持版本","badge-text":"LTS 推荐",variant:"lts",onDownloadStart:i,onDownloadComplete:p,onDownloadError:I},{icon:S(()=>[...t[0]||(t[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])]),_:1},8,["url","filename","version","date"])):B("",!0),y.value&&y.value.version!==b.value?.version?(u(),z(N,{key:1,url:$(a).getDownloadInfo(y.value.version).url,filename:$(a).getDownloadInfo(y.value.version).filename,version:y.value.version,date:y.value.date,label:"最新稳定版本","badge-text":"最新",variant:"current",onDownloadStart:i,onDownloadComplete:p,onDownloadError:I},{icon:S(()=>[...t[1]||(t[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])]),_:1},8,["url","filename","version","date"])):B("",!0)]),e("div",ue,[e("div",ce,[t[16]||(t[16]=e("div",{class:"w-12 h-12 bg-gradient-to-br from-gray-400 to-gray-500 rounded-lg flex items-center justify-center flex-shrink-0"},[e("svg",{class:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})])],-1)),e("div",fe,[e("div",pe,[e("div",ve,[t[4]||(t[4]=e("span",{class:"text-sm text-gray-500"},"本地安装版本",-1)),t[5]||(t[5]=e("span",{class:"px-2 py-0.5 bg-gray-500 text-white text-xs font-bold rounded"}," 本地 ",-1)),$(a).nodeInfo.hasUpdate?(u(),g("span",ge,[...t[3]||(t[3]=[e("svg",{class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1),M(" 有新版本 ",-1)])])):(u(),g("span",me,[...t[2]||(t[2]=[e("svg",{class:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),M(" 已是最新 ",-1)])]))]),e("div",xe,[e("div",we,[e("button",{onClick:f,disabled:r.value||!d.value.pnpmInstalled,class:C(["relative inline-flex items-center gap-2 px-3 py-1.5 rounded-lg font-medium transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed",d.value.enabled?"bg-gradient-to-r from-green-500 to-emerald-500 text-white shadow-lg shadow-green-500/30 hover:shadow-green-500/50 hover:scale-105":"bg-gradient-to-r from-gray-400 to-gray-500 text-white shadow-lg shadow-gray-500/30 hover:shadow-gray-500/50 hover:scale-105"]),title:d.value.pnpmInstalled?d.value.enabled?"点击禁用 npm→pnpm 转换":"点击启用 npm→pnpm 转换":"pnpm 未安装"},[r.value?(u(),g("svg",be,[...t[6]||(t[6]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(u(),g(G,{key:1},[t[8]||(t[8]=e("span",{class:"text-xs font-bold uppercase"},"npm",-1)),(u(),g("svg",{class:C(["w-3 h-3 transition-transform duration-300",d.value.enabled?"scale-100":"scale-75 opacity-50"]),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[...t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M9 5l7 7-7 7"},null,-1)])],2)),t[9]||(t[9]=e("span",{class:"text-xs font-bold uppercase"},"pnpm",-1)),e("div",{class:C(["w-2 h-2 rounded-full transition-all duration-300",d.value.enabled?"bg-white shadow-lg shadow-white/50":"bg-gray-300"])},null,2)],64))],10,he),d.value.pnpmInstalled?B("",!0):(u(),g("div",ye,[...t[10]||(t[10]=[M(" pnpm 未安装，请先安装 ",-1),e("div",{class:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900"},null,-1)])]))]),e("button",{onClick:o,disabled:c.value,class:"p-1.5 hover:bg-gray-100 rounded-lg transition-colors group disabled:cursor-not-allowed disabled:opacity-50",title:"刷新版本信息"},[c.value?(u(),g("svg",Ce,[...t[12]||(t[12]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(u(),g("svg",_e,[...t[11]||(t[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])]))],8,ke)])]),e("div",$e,[e("div",Ie,[t[13]||(t[13]=e("span",{class:"text-xs text-gray-500"},"Node.js",-1)),e("span",je,k($(a).nodeInfo.nodeVersion||"未安装"),1)]),e("div",De,[t[14]||(t[14]=e("span",{class:"text-xs text-gray-500"},"npm",-1)),e("span",Ve,k($(a).nodeInfo.npmVersion||"未安装"),1)]),e("div",Pe,[t[15]||(t[15]=e("p",{class:"text-xs text-gray-500 mb-1"},"安装路径",-1)),e("p",Be,k($(a).nodeInfo.nodePath||"未知"),1)])])])])])])])])]))}}),ze=(x,a)=>{const s=x.__vccOpts||x;for(const[c,r]of a)s[c]=r;return s},Ne=ze(Me,[["__scopeId","data-v-c0cef825"]]);export{Ne as default};
